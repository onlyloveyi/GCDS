<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>采购方案生成 - 公诚DeepSeek</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .required-field::after {
            content: "*";
            color: #EF4444;
            margin-left: 0.25rem;
        }
        .form-error {
            color: #EF4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: none;
        }
        .input.error {
            border-color: #EF4444;
        }
        .module-nav {
            display: flex;
            overflow-x: auto;
            padding: 0.5rem 0;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            gap: 1rem;
        }
        .module-nav-item {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .module-nav-item.active {
            background-color: #0D9488;
            color: white;
        }
        .module-nav-item:hover:not(.active) {
            background-color: #F3F4F6;
        }
        .autosave-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 0.75rem;
            color: #6B7280;
            visibility: hidden;
        }
        .autosave-indicator.saving {
            visibility: visible;
        }
        .autosave-indicator.saved {
            color: #10B981;
            visibility: visible;
        }
        .conditional-field {
            display: none;
        }
        .conditional-field.visible {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="main-layout">
        <!-- 侧边栏 -->
        <div class="sidebar h-screen">
            <div class="mb-8">
                <div class="flex items-center mb-6">
                    <img src="../img/logo-sm.svg" alt="Logo" class="rounded-lg mr-3">
                    <h1 class="text-xl font-bold">公诚DeepSeek</h1>
                </div>
                
                <div class="relative">
                    <input type="text" class="input pl-10" placeholder="搜索...">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <nav>
                <div class="text-xs uppercase font-semibold text-gray-500 mb-2 ml-2">主菜单</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>首页</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-comments"></i>
                    <span>对话</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-book"></i>
                    <span>知识库</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>景点问答</span>
                </a>
                
                <div class="text-xs uppercase font-semibold text-gray-500 mb-2 mt-6 ml-2">智能体</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-robot"></i>
                    <span>智能体选择</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>财务智能体</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-gavel"></i>
                    <span>招标智能体</span>
                </a>
                
                <div class="text-xs uppercase font-semibold text-gray-500 mb-2 mt-6 ml-2">招标工具</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-file-contract"></i>
                    <span>招标文件稽核</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-file-alt"></i>
                    <span>投标文件稽核</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-clipboard-check"></i>
                    <span>专家评审表稽核</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-video"></i>
                    <span>评委视频稽核</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-file-invoice"></i>
                    <span>采购文件生成</span>
                </a>
                <a href="#" class="nav-item active">
                    <i class="fas fa-project-diagram"></i>
                    <span>采购方案生成</span>
                </a>
            </nav>
        </div>
        
        <!-- 主内容区 -->
        <div class="flex flex-col h-screen">
            <!-- 顶部导航 -->
            <div class="top-nav">
                <div class="flex-1">
                    <div class="flex items-center">
                        <h2 class="text-xl font-semibold">采购方案生成</h2>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="btn btn-outline">
                        <i class="fas fa-history mr-2"></i>
                        历史记录
                    </button>
                    <div class="relative">
                        <img src="../img/user-avatar.svg" alt="用户头像" class="w-10 h-10 rounded-full">
                    </div>
                </div>
            </div>
            
            <!-- 主要内容 -->
            <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                <div class="max-w-5xl mx-auto">
                    <!-- 顶部进度条 -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 relative">
                                <div class="h-2 bg-teal-500 rounded-l-full"></div>
                                <div class="flex items-center justify-center absolute -top-2 left-0 w-6 h-6 rounded-full bg-teal-500 text-white">
                                    <i class="fas fa-check text-xs"></i>
                                </div>
                                <div class="absolute -bottom-8 left-0 font-medium text-teal-500 text-center w-20 -ml-6">基本信息</div>
                            </div>
                            <div class="flex-1 relative">
                                <div class="h-2 bg-gray-300"></div>
                                <div class="flex items-center justify-center absolute -top-2 left-1/2 w-6 h-6 rounded-full bg-gray-300 text-white transform -translate-x-1/2">
                                    <span class="text-xs">2</span>
                                </div>
                                <div class="absolute -bottom-8 left-1/2 font-medium text-gray-500 text-center w-20 transform -translate-x-1/2">方案选项</div>
                            </div>
                            <div class="flex-1 relative">
                                <div class="h-2 bg-gray-300 rounded-r-full"></div>
                                <div class="flex items-center justify-center absolute -top-2 right-0 w-6 h-6 rounded-full bg-gray-300 text-white">
                                    <span class="text-xs">3</span>
                                </div>
                                <div class="absolute -bottom-8 right-0 font-medium text-gray-500 text-center w-20 -mr-6">生成完成</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 主要内容区 -->
                    <div class="bg-white rounded-xl shadow-sm p-8 mb-6">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 rounded-full bg-teal-100 flex items-center justify-center mr-4">
                                <i class="fas fa-project-diagram text-teal-500 text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold">采购方案生成</h2>
                                <p class="text-gray-600">智能生成符合法规的采购实施方案</p>
                            </div>
                        </div>
                        
                        <!-- 模块化导航 -->
                        <div class="module-nav">
                            <div class="module-nav-item active" data-target="basic-info">基本信息</div>
                            <div class="module-nav-item" data-target="procurement-needs">采购需求与范围</div>
                            <div class="module-nav-item" data-target="market-research">市场调研情况</div>
                            <div class="module-nav-item" data-target="project-category">采购项目分类</div>
                            <div class="module-nav-item" data-target="approval-status">采购批准情况</div>
                        </div>
                        
                        <form id="procurementPlanForm" class="border-t border-gray-200 pt-6">
                            <!-- 自动保存提示 -->
                            <div class="flex justify-end mb-4">
                                <span class="autosave-indicator" id="autosaveIndicator">
                                    <i class="fas fa-sync-alt fa-spin mr-1"></i>
                                    <span id="autosaveText">自动保存中...</span>
                                </span>
                            </div>

                            <!-- 基本信息 -->
                            <div class="form-section active" id="basic-info">
                                <h3 class="font-medium text-lg mb-4">基本信息</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1 required-field">项目名称</label>
                                        <input type="text" class="input w-full" name="projectName" placeholder="某市政务信息系统集成项目" required>
                                        <div class="form-error">请输入项目名称</div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">项目编号</label>
                                        <input type="text" class="input w-full" name="projectCode" placeholder="例如：GCZY-2023-015">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1 required-field">采购人</label>
                                        <input type="text" class="input w-full" name="procurer" placeholder="某市政务服务数据管理局" required>
                                        <div class="form-error">请输入采购人</div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">采购单位性质</label>
                                        <select class="input w-full" name="procurerType">
                                            <option value="">请选择采购单位性质</option>
                                            <option value="government">政府机关</option>
                                            <option value="institution">事业单位</option>
                                            <option value="soe">国有企业</option>
                                            <option value="other">其他</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1 required-field">项目预算金额(万元)</label>
                                        <input type="number" class="input w-full" name="budget" placeholder="500" required min="0">
                                        <div class="form-error">请输入有效的项目预算金额</div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">资金来源</label>
                                        <select class="input w-full" name="fundingSource">
                                            <option value="">请选择资金来源</option>
                                            <option value="fiscal">财政资金</option>
                                            <option value="self">自筹资金</option>
                                            <option value="special">专项资金</option>
                                            <option value="mixed">混合资金</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 采购需求与范围 -->
                            <div class="form-section hidden" id="procurement-needs">
                                <h3 class="font-medium text-lg mb-4">采购需求与范围</h3>
                                
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-1 required-field">采购基本需求</label>
                                    <textarea class="input w-full h-32" name="procurementNeeds" placeholder="请填写采购内容、背景、目标等基本情况，也可上传需求文档由系统自动提取" required></textarea>
                                    <div class="form-error">请填写采购基本需求</div>
                                    <div class="mt-2 flex items-center">
                                        <button type="button" class="text-sm text-teal-600 hover:text-teal-800 flex items-center">
                                            <i class="fas fa-upload mr-1"></i>
                                            上传需求文档
                                        </button>
                                        <span class="mx-2 text-gray-300">|</span>
                                        <button type="button" class="text-sm text-teal-600 hover:text-teal-800 flex items-center">
                                            <i class="fas fa-microphone mr-1"></i>
                                            语音输入
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">采购属性</label>
                                        <select class="input w-full" name="procurementAttribute">
                                            <option value="">请选择采购属性</option>
                                            <option value="first">首次采购</option>
                                            <option value="repeat">重复采购</option>
                                            <option value="additional">追加采购</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">采购周期</label>
                                        <select class="input w-full" name="procurementCycle">
                                            <option value="">请选择采购周期</option>
                                            <option value="single">单次采购</option>
                                            <option value="continuous">连续性采购</option>
                                            <option value="framework">框架协议</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 市场调研情况 -->
                            <div class="form-section hidden" id="market-research">
                                <h3 class="font-medium text-lg mb-4">市场调研情况</h3>
                                
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">市场供应商情况</label>
                                    <select class="input w-full mb-4" name="marketSuppliers">
                                        <option value="">请选择市场供应商情况</option>
                                        <option value="many">供应商众多，市场竞争充分</option>
                                        <option value="few">市场供应商较少（少于5家）</option>
                                        <option value="monopoly">市场垄断或寡头垄断</option>
                                        <option value="single">唯一供应商</option>
                                        <option value="unknown">暂无调研</option>
                                    </select>
                                    
                                    <label class="block text-sm font-medium text-gray-700 mb-1">市场调研结果描述</label>
                                    <textarea class="input w-full h-24" name="marketResearch" placeholder="请描述市场调研的方法和结果，包括供应商情况、价格区间、产品服务质量等..."></textarea>
                                </div>
                            </div>
                            
                            <!-- 采购项目分类 -->
                            <div class="form-section hidden" id="project-category">
                                <h3 class="font-medium text-lg mb-4">采购项目分类</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                    <div class="border rounded-lg p-4 bg-teal-50 border-teal-200 relative project-type-item">
                                        <input type="radio" name="projectType" id="itSystem" value="itSystem" checked class="absolute right-3 top-3" required>
                                        <label for="itSystem" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-laptop-code text-teal-500 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">信息化类</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">信息系统、软件、IT服务等</p>
                                        </label>
                                    </div>
                                    
                                    <div class="border rounded-lg p-4 hover:bg-gray-50 relative project-type-item">
                                        <input type="radio" name="projectType" id="goods" value="goods" class="absolute right-3 top-3">
                                        <label for="goods" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-boxes text-gray-400 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">货物类</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">设备、物资、办公用品等</p>
                                        </label>
                                    </div>
                                    
                                    <div class="border rounded-lg p-4 hover:bg-gray-50 relative project-type-item">
                                        <input type="radio" name="projectType" id="service" value="service" class="absolute right-3 top-3">
                                        <label for="service" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-concierge-bell text-gray-400 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">服务类</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">咨询、培训、外包服务等</p>
                                        </label>
                                    </div>
                                    
                                    <div class="border rounded-lg p-4 hover:bg-gray-50 relative project-type-item">
                                        <input type="radio" name="projectType" id="engineering" value="engineering" class="absolute right-3 top-3">
                                        <label for="engineering" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-hard-hat text-gray-400 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">工程类</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">建设工程、维修改造等</p>
                                        </label>
                                    </div>
                                    
                                    <div class="border rounded-lg p-4 hover:bg-gray-50 relative project-type-item">
                                        <input type="radio" name="projectType" id="ppp" value="ppp" class="absolute right-3 top-3">
                                        <label for="ppp" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-handshake text-gray-400 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">PPP项目</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">政府和社会资本合作项目</p>
                                        </label>
                                    </div>
                                    
                                    <div class="border rounded-lg p-4 hover:bg-gray-50 relative project-type-item">
                                        <input type="radio" name="projectType" id="other" value="other" class="absolute right-3 top-3">
                                        <label for="other" class="block cursor-pointer">
                                            <div class="text-center mb-2">
                                                <i class="fas fa-tools text-gray-400 text-3xl"></i>
                                            </div>
                                            <h4 class="font-medium text-center">其他类型</h4>
                                            <p class="text-xs text-gray-600 text-center mt-1">自定义项目类型</p>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 采购批准情况 -->
                            <div class="form-section hidden" id="approval-status">
                                <h3 class="font-medium text-lg mb-4">采购批准情况</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">项目是否已批准</label>
                                        <select class="input w-full" id="approvalStatus" name="approvalStatus">
                                            <option value="">请选择批准状态</option>
                                            <option value="yes">是，已获批准</option>
                                            <option value="no">否，尚未批准</option>
                                            <option value="part">部分批准</option>
                                        </select>
                                    </div>
                                    
                                    <div id="approvalNumberField" class="conditional-field">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">批准文号</label>
                                        <input type="text" class="input w-full" name="approvalNumber" placeholder="例如：某发改[2023]123号">
                                    </div>
                                    
                                    <div id="approvalDescField" class="conditional-field col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">批准情况说明</label>
                                        <textarea class="input w-full h-20" name="approvalDescription" placeholder="请简要描述项目的立项和批准情况..."></textarea>
                                    </div>
                                    
                                    <div id="planToApproveField" class="conditional-field col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">预计批准时间</label>
                                        <input type="date" class="input w-full" name="expectedApprovalDate">
                                        <div class="mt-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">采购前置条件</label>
                                            <textarea class="input w-full h-20" name="preConditions" placeholder="请描述在正式采购前还需要满足的前置条件..."></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-teal-50 border-l-4 border-teal-400 p-4 mb-6">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-info-circle text-teal-400"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-teal-700">
                                                完成基本信息填写后，点击"下一步"进入方案选项页面，AI将根据您提供的信息推荐适合的采购方式、评审方法等选项。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <div class="flex items-center">
                                    <button type="button" id="prevBtn" class="btn btn-outline opacity-50 cursor-not-allowed" disabled>
                                        <i class="fas fa-arrow-left mr-2"></i>
                                        上一项
                                    </button>
                                    <button type="button" id="nextBtn" class="btn btn-outline ml-3">
                                        下一项
                                        <i class="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                <div>
                                    <button type="button" id="saveBtn" class="btn btn-outline mr-4">
                                        <i class="fas fa-save mr-2"></i>
                                        保存草稿
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        下一步
                                        <i class="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 模块导航功能
            const moduleNavItems = document.querySelectorAll('.module-nav-item');
            const formSections = document.querySelectorAll('.form-section');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            let currentSectionIndex = 0;

            // 自动保存功能
            const form = document.getElementById('procurementPlanForm');
            const autosaveIndicator = document.getElementById('autosaveIndicator');
            const autosaveText = document.getElementById('autosaveText');
            let autosaveTimeout;
            
            // 采购批准状态相关字段
            const approvalStatus = document.getElementById('approvalStatus');
            const approvalNumberField = document.getElementById('approvalNumberField');
            const approvalDescField = document.getElementById('approvalDescField');
            const planToApproveField = document.getElementById('planToApproveField');
            
            // 切换模块显示
            function showSection(index) {
                formSections.forEach((section, i) => {
                    if (i === index) {
                        section.classList.remove('hidden');
                        section.classList.add('active');
                        moduleNavItems[i].classList.add('active');
                    } else {
                        section.classList.add('hidden');
                        section.classList.remove('active');
                        moduleNavItems[i].classList.remove('active');
                    }
                });
                
                // 更新上一步/下一步按钮状态
                prevBtn.disabled = index === 0;
                prevBtn.classList.toggle('opacity-50', index === 0);
                prevBtn.classList.toggle('cursor-not-allowed', index === 0);
                
                nextBtn.disabled = index === formSections.length - 1;
                nextBtn.classList.toggle('opacity-50', index === formSections.length - 1);
                nextBtn.classList.toggle('cursor-not-allowed', index === formSections.length - 1);
                
                currentSectionIndex = index;
            }
            
            // 导航点击事件
            moduleNavItems.forEach((item, index) => {
                item.addEventListener('click', () => {
                    showSection(index);
                });
            });
            
            // 上一步/下一步按钮
            prevBtn.addEventListener('click', () => {
                if (currentSectionIndex > 0) {
                    showSection(currentSectionIndex - 1);
                }
            });
            
            nextBtn.addEventListener('click', () => {
                if (currentSectionIndex < formSections.length - 1) {
                    showSection(currentSectionIndex + 1);
                }
            });
            
            // 项目类型选择
            const projectTypeItems = document.querySelectorAll('.project-type-item');
            projectTypeItems.forEach(item => {
                item.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    // 更新样式
                    projectTypeItems.forEach(typeItem => {
                        if (typeItem.querySelector('input[type="radio"]').checked) {
                            typeItem.classList.add('bg-teal-50', 'border-teal-200');
                            typeItem.querySelector('i').classList.remove('text-gray-400');
                            typeItem.querySelector('i').classList.add('text-teal-500');
                        } else {
                            typeItem.classList.remove('bg-teal-50', 'border-teal-200');
                            typeItem.querySelector('i').classList.add('text-gray-400');
                            typeItem.querySelector('i').classList.remove('text-teal-500');
                        }
                    });
                    
                    autoSave();
                });
            });
            
            // 处理批准状态的显示逻辑
            approvalStatus.addEventListener('change', function() {
                const selectedValue = this.value;
                
                // 隐藏所有相关字段
                approvalNumberField.classList.remove('visible');
                approvalDescField.classList.remove('visible');
                planToApproveField.classList.remove('visible');
                
                // 根据选择的值显示相应字段
                if (selectedValue === 'yes' || selectedValue === 'part') {
                    approvalNumberField.classList.add('visible');
                    approvalDescField.classList.add('visible');
                } else if (selectedValue === 'no') {
                    planToApproveField.classList.add('visible');
                }
                
                autoSave();
            });
            
            // 表单验证
            function validateCurrentSection() {
                const currentSection = formSections[currentSectionIndex];
                const requiredFields = currentSection.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value) {
                        field.classList.add('error');
                        const errorElement = field.nextElementSibling;
                        if (errorElement && errorElement.classList.contains('form-error')) {
                            errorElement.style.display = 'block';
                        }
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                        const errorElement = field.nextElementSibling;
                        if (errorElement && errorElement.classList.contains('form-error')) {
                            errorElement.style.display = 'none';
                        }
                    }
                });
                
                return isValid;
            }
            
            // 自动保存
            function autoSave() {
                clearTimeout(autosaveTimeout);
                
                autosaveTimeout = setTimeout(() => {
                    // 显示保存中状态
                    autosaveIndicator.classList.add('saving');
                    autosaveIndicator.classList.remove('saved');
                    autosaveText.textContent = '自动保存中...';
                    
                    // 模拟保存数据
                    setTimeout(() => {
                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData.entries());
                        
                        // 保存到localStorage（实际项目中会发送到服务器）
                        localStorage.setItem('procurementPlanDraft', JSON.stringify({
                            data: data,
                            timestamp: new Date().toISOString()
                        }));
                        
                        // 显示已保存状态
                        autosaveIndicator.classList.remove('saving');
                        autosaveIndicator.classList.add('saved');
                        autosaveText.textContent = '已自动保存';
                        
                        // 3秒后隐藏提示
                        setTimeout(() => {
                            autosaveIndicator.classList.remove('saved');
                        }, 3000);
                    }, 800);
                }, 1000);
            }
            
            // 手动保存
            document.getElementById('saveBtn').addEventListener('click', function() {
                // 显示保存中状态
                autosaveIndicator.classList.add('saving');
                autosaveIndicator.classList.remove('saved');
                autosaveText.textContent = '保存中...';
                
                setTimeout(() => {
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    // 保存到localStorage（实际项目中会发送到服务器）
                    localStorage.setItem('procurementPlanDraft', JSON.stringify({
                        data: data,
                        timestamp: new Date().toISOString()
                    }));
                    
                    // 显示已保存状态
                    autosaveIndicator.classList.remove('saving');
                    autosaveIndicator.classList.add('saved');
                    autosaveText.textContent = '已保存草稿';
                    
                    // 提示用户
                    alert('草稿已保存成功！');
                }, 800);
            });
            
            // 加载保存的草稿
            function loadDraft() {
                const savedDraft = localStorage.getItem('procurementPlanDraft');
                if (savedDraft) {
                    try {
                        const { data } = JSON.parse(savedDraft);
                        
                        // 填充表单数据
                        Object.entries(data).forEach(([name, value]) => {
                            const field = form.elements[name];
                            if (field) {
                                if (field.type === 'checkbox') {
                                    field.checked = value === '1';
                                } else if (field.type === 'radio') {
                                    const radio = document.getElementById(value);
                                    if (radio) radio.checked = true;
                                } else {
                                    field.value = value;
                                }
                            }
                        });
                        
                        // 更新项目类型样式
                        const selectedType = document.querySelector('input[name="projectType"]:checked');
                        if (selectedType) {
                            const selectedItem = selectedType.closest('.project-type-item');
                            projectTypeItems.forEach(item => {
                                if (item === selectedItem) {
                                    item.classList.add('bg-teal-50', 'border-teal-200');
                                    item.querySelector('i').classList.remove('text-gray-400');
                                    item.querySelector('i').classList.add('text-teal-500');
                                } else {
                                    item.classList.remove('bg-teal-50', 'border-teal-200');
                                    item.querySelector('i').classList.add('text-gray-400');
                                    item.querySelector('i').classList.remove('text-teal-500');
                                }
                            });
                        }
                        
                        // 处理采购批准状态的条件显示
                        if (data.approvalStatus) {
                            approvalStatus.value = data.approvalStatus;
                            
                            // 触发条件显示逻辑
                            const event = new Event('change');
                            approvalStatus.dispatchEvent(event);
                        }
                        
                        // 提示用户已加载草稿
                        autosaveIndicator.classList.add('saved');
                        autosaveText.textContent = '已加载草稿';
                        
                        setTimeout(() => {
                            autosaveIndicator.classList.remove('saved');
                        }, 3000);
                        
                    } catch (e) {
                        console.error('加载草稿失败', e);
                    }
                }
            }
            
            // 表单提交
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateCurrentSection()) {
                    // 提交表单逻辑 - 此处可以发送到服务器
                    // 模拟处理
                    alert('表单验证通过，即将进入下一步！');
                    window.location.href = '?step=2'; // 实际项目中跳转到下一步
                }
            });
            
            // 所有输入框变化时触发自动保存
            form.addEventListener('input', autoSave);
            form.addEventListener('change', autoSave);
            
            // 初始化显示第一个模块
            showSection(0);
            
            // 加载草稿
            loadDraft();
        });
    </script>
</body>
</html> 